# Maintainer : Wabuo <spam.wabuo@googlemail.com>

pkgname=hiawatha-monitor
pkgver=1.4
pkgrel=0
pkgdesc="The Hiawatha Monitor is a monitoring tool for the Hiawatha webserver. It can be used to keep track of the performance and security of all your Hiawatha webservers via one single interface."
arch=('any')
url="https://www.hiawatha-webserver.org/monitor"
license=('custom')
source=("https://www.hiawatha-webserver.org/files/monitor-${pkgver}.tar.gz"
        'https://raw.githubusercontent.com/hsleisink/monitor/master/LICENSE'
        'https://raw.githubusercontent.com/Wabuo/PKGBUILD/master/hiawatha-monitor/hiawatha_monitor.conf'
        'https://raw.githubusercontent.com/Wabuo/PKGBUILD/master/hiawatha-monitor/systemd_timers/hiawatha-monitor_delete_old_logs.service'
        'https://raw.githubusercontent.com/Wabuo/PKGBUILD/master/hiawatha-monitor/systemd_timers/hiawatha-monitor_delete_old_logs.timer'
        'https://github.com/Wabuo/PKGBUILD/raw/master/hiawatha-monitor/systemd_timers/hiawatha-monitor_fetch_webserver_logs.service'
        'https://github.com/Wabuo/PKGBUILD/raw/master/hiawatha-monitor/systemd_timers/hiawatha-monitor_fetch_webserver_logs.timer'
        'https://github.com/Wabuo/PKGBUILD/raw/master/hiawatha-monitor/systemd_timers/hiawatha-monitor_send_reports.service'
        'https://github.com/Wabuo/PKGBUILD/raw/master/hiawatha-monitor/systemd_timers/hiawatha-monitor_send_reports.timer')
#validpgpkeys=('E50EF6D35253C390580747781D3F7F8594C766C9') # Wabuo

#The devolopers don't provide any checksums! Checksums generated by me!
sha256sums=('')

install=${pkgname}.install

package() {
  ls -la ${srcdir}
  install -d "${pkgdir}/etc/webapps/${pkgname}"
  install -d "${pkgdir}/usr/share/webapps/${pkgname}"
  install -d "${pkgdir}/etc/systemd/system/"

  install -D -m644 "${srcdir}/LICENSE" "${pkgdir}/usr/share/licenses/${pkgname}/LICENSE"
  install -D -m644 "${srcdir}/hiawatha_monitor.conf" "${pkgdir}/etc/webapps/${pkgname}/hiawatha_monitor.conf"

  cp -a "monitor/*" "${pkgdir}/usr/share/webapps/${pkgname}"
  cp -a "systemd_timers/*" "${pkgdir}/etc/systemd/system/"

  ln -s "/usr/share/webapps/${pkgname}/settings" "${pkgdir}/etc/webapps/${pkgname}/settings"
}
